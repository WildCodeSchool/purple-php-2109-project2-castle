{% extends 'layout.html.twig' %}

{% block title %}
Result of fight
{% endblock %}
{% block content %}
<section class="sky">
    <img class="castle" src="assets/images/mobile/battle_castle.png" alt="Castle open door">
    <div class="backgroundRound">
        <h1 id="timer"></h1>
    </div>
</section>
<section class="grass">
    <img class="indice" src="assets/images/mobile/tent.png" alt="image enemy indice ">
    <div class="alignChoice">
        <div class="backgroundChoice">
            <div class="oneTroop">
                {% if troop.vigor == 3 or troop.vigor == 2 %}
                <p class="yellow">
                    {% elseif troop.vigor == 1 %}
                <p class="red">
                    {% else %}
                <p class="green">
                    {% endif %}
                    <img src={{ trooperPlayer.image}} alt="asset troop ">
                </p>
                <p><img src={{ trooperPlayer.imgVigor }} alt="asset vigor troop {{ trooperPlayer.vigor}} / 5 "></p>
            </div>
        </div>
        <p>~ VS ~</p>
        <div class="backgroundChoice">
            <p id="enemy" class="green"><img src='assets/images/mobile/return_icon.png' alt='asset enemy'></p>
            <p><img src={{ session.saveEnemy.imgVigor }} alt="asset vigor enemy {{ session.saveEnemy.vigor }} / 5"></p>
        </div>
    </div>
    <P class="score"> Score <br>{{session.score}}</P>
</section>
{% endblock %}
{% block javascript %}
<script>
    let result = {{ result }};
    let time = 4;
    const timerElement = document.getElementById("timer");
    const enemy = document.getElementById("enemy");
    const changeEnemy = "<img src={{ session.saveEnemy.image }} alt='asset enemy'>";
    const win = "<img class='win' src='assets/images/mobile/happy_emoji.png' alt='emoji win'>";
    const loose = "<img class='loose' src='assets/images/mobile/sad_emoji.png' alt='emoji loose'>";
    function reduceTime() {
        timerElement.innerText = time;
        time--;
        switch (time) {
            case 3:
                timerElement.innerText = time;
                break;
            case 2:
                timerElement.innerText = time;
                break;
            case 1:
                timerElement.innerText = time;
                break;
            case 0:
                enemy.innerHTML = changeEnemy;
                if (result < 0) {
                    timerElement.innerHTML = loose;
                } else {
                    timerElement.innerHTML = win;
                }
                break;
            case -1:
                document.location.href = '/getready';
        }
    }
    setInterval(reduceTime, 1000);
</script>
{% endblock %}